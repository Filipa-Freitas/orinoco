<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Ours en peluche faits main | Orinoco</title>
        <meta name="description" content=""/>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css" integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk" crossorigin="anonymous">
        <link rel="stylesheet" href="./css/style.css">
    </head>
	<body>
        <header class="bg-light-pink">
            <div class="container">
                <div class="row">
                    <nav class="col navbar navbar-expand-lg">
                        <a href="/" class="navbar-brand" >
                            <img src="/images/15675819263013_image1.png" width="150" height="80" alt="Site logo">
                        </a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"><i class="fas fa-bars"></i></span>
                        </button>
                        <div id="navbarContent" class="collapse navbar-collapse flex-row-reverse">
                            <ul class="navbar-nav">
                                <li class="nav-item active">
                                    <a href="/" class="nav-link">Accueil</a>
                                </li>
                                <li class="nav-item">
                                    <a href="/order" class="nav-link">Panier</i></a>
                                </li>
                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
        </header>
        
        <div class="container">
            <div id="container" class="row">
            </div>
            <button id="order-btn" class="btn btn-primary">Ajouter au panier</button>
        </div>
        <footer class="bg-light mt-4">
            <div class="container">
              <div class="row pt-4 pb-3">
                <div class="col">
                    <ul class="list-inline text-center">
                        <li class="list-inline-item"><a href="#">À propos</a></li>
                        <li class="list-inline-item"><a href="#">Vie privée</a></li>
                        <li class="list-inline-item"><a href="#">Conditions d'utilisations</a></li>
                    </ul>
                </div>
              </div>
            </div>
        </footer>
        <script>
            // console.log("test", document.cookie);
            var cookies = document.cookie.split("=");
            var productId = cookies[1];
            var container = document.getElementById('container');
            // var product = [];

            async function getData() {
                const response = await fetch('/api/teddies/'+ productId);
                if(!response.ok) {
                    throw new Error(`Erreur HTTP ! statut : ${response.status}`);
                }
                return await response.json();
            }

            async function displayContent() {
                const product = await getData();
                
                var card = document.createElement('div');
                var img = document.createElement('img');
                var select = document.createElement('select');
                var option1 = document.createElement('option');
                var cardBody = document.createElement('div');
                var cardName = document.createElement('p');
                var cardPrice = document.createElement('p');
                var cardDescription = document.createElement('p');

                card.className = "col-8 card my-2 p-2 shadow-sm";
                img.className = "card-img-top";
                cardBody.className = "card-body";
                cardPrice.className = "card-text";
                cardDescription.className = "card-text";
                cardName.className = "card-title";

                img.src = product.imageUrl;
                img.alt = product.description;
                cardPrice.innerText = product.price+ " €";
                cardName.innerText = product.name;
                cardDescription.innerText = product.description;
                option1.innerText = "--Choisissez une couleur--";
            
                cardBody.append(select);
                select.append(option1);
                cardBody.append(cardName);
                cardBody.append(cardPrice);
                cardBody.append(cardDescription);
                card.append(img);
                card.append(cardBody);
                container.append(card);
                
                for(var i = 0; i < product.colors.length; i++) {
                    var option = document.createElement('option');
                    option.innerText = product.colors[i];
                    option.value = product.colors[i];
                    select.append(option);
                }
            }
            displayContent();

            var btn = document.querySelector('#order-btn');

            btn.addEventListener('click', async function() {
                const product = await getData();
                var products = JSON.parse(localStorage.getItem("products"));
                product.quantity = 1;

                if (products) {
                    var found = products.find(function(element, index) {
                        if (element._id == product._id) {
                            return true;
                        } else {
                            return false;
                        }
                    });

                    if (!found) {
                        products.push(product);
                        localStorage.setItem("products", JSON.stringify(products));

                    }
                } else {
                    products = [];
                    products.push(product);
                    localStorage.setItem("products", JSON.stringify(products));
                }
            });
            
            /*
            function async getData() return res.json()
            function displayContent() qui appel await getData() => créer le html
            ajout eventListener click sur bouton # => async function () const toto = await getData => localStorage(toto);
            */

        </script>
        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    </body>
</html>
